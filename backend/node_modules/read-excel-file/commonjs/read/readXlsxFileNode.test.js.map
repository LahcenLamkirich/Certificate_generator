{"version":3,"sources":["../../source/read/readXlsxFileNode.test.js"],"names":["describe","it","schema","prop","type","Date","Number","required","Boolean","String","parse","value","rowMap","path","resolve","__dirname","then","rows","date","getTime","should","deep","equal","convertToUTCTimezone","numberOfStudents","course","isFree","cost","title","contact","map","errors","getTimezoneOffset"],"mappings":"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","sourcesContent":["import path from 'path'\r\n\r\nimport readXlsxFileNode from './readXlsxFileNode'\r\n\r\ndescribe('readXlsxFileNode', () => {\r\n\tit('should read *.xlsx file on Node.js and parse it to JSON', () => {\r\n\t\tconst schema = {\r\n\t\t\t'START DATE': {\r\n\t\t\t\tprop: 'date',\r\n\t\t\t\ttype: Date\r\n\t\t\t},\r\n\t\t\t'NUMBER OF STUDENTS': {\r\n\t\t\t\tprop: 'numberOfStudents',\r\n\t\t\t\ttype: Number,\r\n\t\t\t\trequired: true\r\n\t\t\t},\r\n\t\t\t'COURSE': {\r\n\t\t\t\tprop: 'course',\r\n\t\t\t\ttype: {\r\n\t\t\t\t\t'IS FREE': {\r\n\t\t\t\t\t\tprop: 'isFree',\r\n\t\t\t\t\t\ttype: Boolean\r\n\t\t\t\t\t\t// Excel stored booleans as numbers:\r\n\t\t\t\t\t\t// `1` is `true` and `0` is `false`.\r\n\t\t\t\t\t\t// Such numbers are parsed to booleans.\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'COST': {\r\n\t\t\t\t\t\tprop: 'cost',\r\n\t\t\t\t\t\ttype: Number\r\n\t\t\t\t\t},\r\n\t\t\t\t\t'COURSE TITLE': {\r\n\t\t\t\t\t\tprop: 'title',\r\n\t\t\t\t\t\ttype: String\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'CONTACT': {\r\n\t\t\t\tprop: 'contact',\r\n\t\t\t\trequired: true,\r\n\t\t\t\tparse(value) {\r\n\t\t\t\t\treturn '+11234567890'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst rowMap = []\r\n\r\n\t\treturn readXlsxFileNode(path.resolve(__dirname, '../../test/spreadsheets/course.xlsx'), { schema, rowMap }).then(({ rows }) => {\r\n\t\t\trows[0].date = rows[0].date.getTime()\r\n\t\t\trows.should.deep.equal([{\r\n\t\t\t\tdate: convertToUTCTimezone(new Date(2018, 2, 24)).getTime(),\r\n\t\t\t\tnumberOfStudents: 123,\r\n\t\t\t\tcourse: {\r\n\t\t\t\t\tisFree: false,\r\n\t\t\t\t\tcost: 210.45,\r\n\t\t\t\t\ttitle: 'Chemistry'\r\n\t\t\t\t},\r\n\t\t\t\tcontact: '+11234567890'\r\n\t\t\t}])\r\n\t\t\trowMap.should.deep.equal([0, 1])\r\n\t\t})\r\n\t})\r\n\r\n\tit('should read *.xlsx file on Node.js and map it to JSON', () => {\r\n\t\tconst map = {\r\n\t\t\t'START DATE': 'date',\r\n\t\t\t'NUMBER OF STUDENTS': 'numberOfStudents',\r\n\t\t\t'COURSE': {\r\n\t\t\t\t'course': {\r\n\t\t\t\t\t'IS FREE': 'isFree',\r\n\t\t\t\t\t'COST': 'cost',\r\n\t\t\t\t\t'COURSE TITLE': 'title'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'CONTACT': 'contact'\r\n\t\t}\r\n\r\n\t\tconst rowMap = []\r\n\r\n\t\treturn readXlsxFileNode(path.resolve(__dirname, '../../test/spreadsheets/course.xlsx'), { map, rowMap }).then(({ rows, errors }) => {\r\n\t\t\terrors.should.deep.equal([])\r\n\t\t\trows[0].date = rows[0].date.getTime()\r\n\t\t\trows.should.deep.equal([{\r\n\t\t\t\tdate: convertToUTCTimezone(new Date(2018, 2, 24)).getTime(),\r\n\t\t\t\tnumberOfStudents: 123,\r\n\t\t\t\tcourse: {\r\n\t\t\t\t\tisFree: false,\r\n\t\t\t\t\tcost: 210.45,\r\n\t\t\t\t\ttitle: 'Chemistry'\r\n\t\t\t\t},\r\n\t\t\t\tcontact: '(123) 456-7890'\r\n\t\t\t}])\r\n\t\t\trowMap.should.deep.equal([0, 1])\r\n\t\t})\r\n\t})\r\n})\r\n\r\n// Converts timezone to UTC while preserving the same time\r\nfunction convertToUTCTimezone(date) {\r\n\t// Doesn't account for leap seconds but I guess that's ok\r\n\t// given that javascript's own `Date()` does not either.\r\n\t// https://www.timeanddate.com/time/leap-seconds-background.html\r\n\t//\r\n\t// https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date/getTimezoneOffset\r\n\t//\r\n\treturn new Date(date.getTime() - date.getTimezoneOffset() * 60 * 1000)\r\n}\r\n"],"file":"readXlsxFileNode.test.js"}